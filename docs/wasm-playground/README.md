# WASM Playground Build

This directory contains the browser playground with hybrid tile serving: pre-generated static tiles from CI combined with on-demand WASM tile generation.

**Files:**

- `index.html` - Main playground page (served from GitHub Pages)
- `wasm.js` - Browser code (Leaflet tile layer with static-first fetching)
- `wasm_bootstrap.js` - Loads and starts the Go WASM module (`wasm.wasm`)
- `wasm_exec.js` - Go WASM runtime (copied from your Go installation)
- `wasm.wasm` - Compiled WebAssembly module (built from `cmd/wasm`)
- `static-tiles/` - Pre-generated tiles for Hanover demo area (z13-14)

**Build:**

```bash
just build-wasm
```

**Local testing:**

```bash
just build-wasm-local
# Open http://localhost:8000/wasm-playground/
```

**Tile Serving Strategy:** The playground uses a hybrid approach:

1. **Static tiles** (zoom 13-14, Hanover area): Pre-generated via CI and served directly from GitHub Pages
2. **On-demand tiles**: Generated in the browser via WASM + Overpass API for uncovered areas

The playground automatically tries static tiles first and falls back to on-demand generation if a tile isn't available.

## Static Tile Pre-Generation

Static tiles are automatically regenerated by CI when:

- Rendering pipeline code changes
- Watercolor processing logic changes
- Assets (textures, styles) are modified
- Manual workflow dispatch trigger
- Weekly schedule (Sunday 2 AM UTC)

**Static Tile Coverage:**

- **Area**: Hanover, Germany (9.60-9.90°E, 52.30-52.50°N)
- **Zoom levels**: 13-14
- **Tile count**: ~60 tiles
- **Total size**: ~3MB with PNG compression

**To manually regenerate static tiles:**

1. Go to Actions → "Generate Static Tiles for Playground"
2. Click "Run workflow"
3. Wait for completion (~5-10 minutes)
4. Tiles will be committed and deployed automatically

## Local Development

To test the playground locally with static tiles:

```bash
just build-wasm-local
# Open http://localhost:8000/wasm-playground/
```

The static tiles will be served from your local checkout. Pan to Hanover (default view) to see pre-generated tiles. Pan outside the coverage area to see on-demand WASM tile generation.
