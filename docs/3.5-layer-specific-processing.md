# Phase 3.5: Layer-Specific Processing

**Status**: âœ… COMPLETE

## Overview

Applies the full watercolor pipeline per layer with layer-tuned textures, tints, and edge darkening to produce ready-to-composite painted tiles.

## Implementation

**Location**: `internal/watercolor/processor.go`

- `LayerStyle`: Per-layer knobs (texture, tint strength/color, edge color/strength, blur sigmas, gamma).
- `Params`: Common pipeline settings (tile size, blur, noise scale/strength, threshold, antialias, seed, offsets) plus per-layer styles.
- `DefaultParams`: Provides sensible defaults for all layers, wiring in provided base textures.
- `PaintLayer`: Runs mask pipeline, global-aligned noise, texture tiling/tinting, mask application, and edge darkening for a single layer.

## Tests

**Location**: `internal/watercolor/processor_test.go`

- `TestPaintLayerAppliesMaskTintAndEdge`: Validates masking, tinting, and edge darkening produce transparent backgrounds and darker edges than the interior.
- `TestPaintLayerMissingStyle`: Ensures missing style configuration returns an error.

## Usage Example

```go
textures := loadTexturesFromAssets() // map[geojson.LayerType]image.Image
params := watercolor.DefaultParams(256, seed, textures)
params.OffsetX = int(tileX) * params.TileSize
params.OffsetY = int(tileY) * params.TileSize

paintedWater := watercolor.PaintLayer(waterLayerPNG, geojson.LayerWater, params)
paintedLand := watercolor.PaintLayer(landLayerPNG, geojson.LayerLand, params)
// ... per layer as rendered
```

Offsets anchor noise and texture sampling to the global grid, keeping seams invisible across tile boundaries for every layer.
